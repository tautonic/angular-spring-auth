<div ng-switch on="pageType" ng-show="isLoaded">
    <div ng-switch-when="single">
        <h1 ng-show="hasContent">{{discussion.title}}</h1>
        <div class="post">
            <div class="user">
                <p>{{discussion.creator.username}}</p>
                <img ng-src="{{discussion.creator.thumbnail}}">
            </div>
            <p class="content" ng-bind-html="discussion.message" ng-show="!discussion.edit">{{discussion.message}}</p>
            <div class="content" ng-show="discussion.edit">
                <form ng-submit="editPost(discussion)">
                    <textarea style="width: 100%; height: 50px;" ng-model="discussion.edited" ui-tinymce></textarea>
                    <input type="submit" value="Save">
                    <input type="button" ng-click="cancelEdit(discussion)" value="Cancel">
                </form>
            </div>
            <div class="buttons clear" ng-show="auth.isAuthenticated"><button ng-click="replyTo(discussion.message)">Quote</button><button ng-click="edit(discussion)" ng-show="canEdit(discussion)">Edit</button></div>
        </div>

        <div class="post" ng-repeat="post in discussion.children">
            <div class="user">
                <p>{{post.creator.username}}</p>
                <img ng-src="{{post.creator.thumbnail}}">
            </div>
            <p class="content" ng-bind-html="post.message" ng-show="!post.edit">{{post.message}}</p>
            <div class="content" ng-show="post.edit">
                <form ng-submit="editPost(post)">
                    <textarea rows="10" ng-model="post.edited" ui-tinymce></textarea>
                    <input type="submit" value="Save">
                    <input type="button" ng-click="cancelEdit(post)" value="Cancel">
                </form>
            </div>
            <div class="buttons clear" ng-show="auth.isAuthenticated"><button ng-click="replyTo(post.message)">Quote</button><button ng-click="edit(post)" ng-show="canEdit(post)">Edit</button></div>

        </div>
        <button ng-click="replyTo()" ng-show="auth.isAuthenticated">Reply</button>

        <div class="reply" ng-show="reply.show">
            <form name="replyForm" ng-submit="submitReply()">
                <p>{{enterReply}}:</p>
                <textarea rows="10" cols="100" ng-model="reply.message" required ui-tinymce>
                </textarea>
                <br>
                <input type="submit" value="Reply">
                <input type="button" ng-click="cancel()" value="Cancel">
            </form>
        </div>
    </div>

    <div ng-switch-when="new">
        <div class="reply" ng-show="auth.isAuthenticated">
            <form name="newDiscussionForm" ng-submit="createDiscussion()">
                <div ng-show="hasContent">
                    Discussion Title: <input type="text" ng-model="reply.title">
                    <p>Words go here:</p>
                </div>
                <textarea rows="10" cols="100" ng-model="reply.message" required ui-tinymce>
                </textarea>
                <br>
                <input type="submit" value="Start New Discussion">
                <div ng-show="hasContent">
                    <input type="button" ng-click="cancel()" value="Cancel">
                </div>
            </form>
        </div>
        <div ng-show="!auth.isAuthenticated">
            Login or <a ng-href="#/profile">register</a> to start a discussion.
        </div>
    </div>

    <div ng-switch-when="none"></div>

    <div ng-switch-default>
        <div ng-show="auth.isAuthenticated">
            <a ng-href="#/network/new">Start new discussion</a>
        </div>
        <div class="discussion-thread" ng-repeat="thread in discussion">
            <a ng-href="#/network/{{thread.threadId}}">{{thread.title}}</a>
            <div class="started-by">Started by: <a ng-href="#/profile/{{thread.creator._id}}">{{thread.creator.username}}</a></div>
        </div>
        <div ng-show="noDiscussions()">
            No discussions started.
        </div>
    </div>

</div>

<div ng-show="!isLoaded">Loading discussion....</div>